<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>RED-B JACKPOT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #7b1fa2 0, #140022 50%, #020007 100%);
      color: #fff;
      font-family: "Montserrat", system-ui, sans-serif;
    }

    .container {
      width: 95%;
      max-width: 460px;
      background: radial-gradient(circle at top, rgba(123, 31, 162, 0.35), rgba(10, 0, 25, 0.95));
      border-radius: 26px;
      padding: 20px 18px 26px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow:
        0 0 30px rgba(156, 39, 176, 0.9),
        0 0 80px rgba(63, 81, 181, 0.5);
    }

    h1 {
      font-family: "Orbitron", system-ui;
      font-size: 1.8rem;
      letter-spacing: 2px;
      text-transform: uppercase;
      margin-bottom: 6px;
      color: #ffeb3b;
      text-shadow:
        0 0 12px rgba(255, 235, 59, 0.9),
        0 0 18px rgba(255, 193, 7, 0.7);
    }

    .slot-wrapper {
      margin: 12px 0 16px;
      padding: 10px;
      border-radius: 20px;
      background: linear-gradient(135deg, #1a0030, #3a145c);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow:
        inset 0 0 18px rgba(0, 0, 0, 0.9),
        0 0 18px rgba(123, 31, 162, 0.7);
    }

    .slot-machine {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 6px;
      padding: 8px;
      border-radius: 14px;
      background: radial-gradient(circle at top, #eeeeff 0, #cfd8dc 45%, #90a4ae 100%);
      box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.7);
    }

    .reel-column {
      display: grid;
      grid-template-rows: repeat(3, 1fr);
      gap: 4px;
    }

    .cell {
      height: 48px;
      border-radius: 10px;
      background: radial-gradient(circle at top, #ffffff 0, #eceff1 45%, #b0bec5 100%);
      box-shadow:
        inset 0 0 6px rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.6rem;
      color: #000;
      transition: transform 0.15s ease, filter 0.15s ease;
    }

    .cell.win-highlight {
      transform: scale(1.15);
      filter: drop-shadow(0 0 12px #ffeb3b);
    }

    @keyframes shake {
      0% { transform: translateX(0); }
      20% { transform: translateX(-5px); }
      40% { transform: translateX(5px); }
      60% { transform: translateX(-5px); }
      80% { transform: translateX(5px); }
      100% { transform: translateX(0); }
    }
    .shake { animation: shake 0.5s ease; }

    #spinBtn {
      margin-top: 4px;
      width: 100%;
      padding: 12px;
      border-radius: 999px;
      border: none;
      font-family: "Orbitron", system-ui;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      background: radial-gradient(circle at top, #ffeb3b 0, #ff9800 40%, #e91e63 100%);
      color: #2b0b24;
      box-shadow:
        0 6px 0 rgba(123, 31, 162, 1),
        0 0 20px rgba(255, 235, 59, 0.9);
      transform: translateY(0);
    }

    #spinBtn:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      transform: translateY(3px);
    }

    #mensaje {
      margin-top: 14px;
      min-height: 60px;
      font-size: 0.92rem;
    }

    #mensaje.ok {
      color: #c6ff00;
      text-shadow: 0 0 10px rgba(198, 255, 0, 0.8);
      font-weight: 700;
    }

    #mensaje.error {
      color: #ff8a80;
      font-weight: 600;
    }

    .info-intentos {
      margin-top: 8px;
      font-size: 0.85rem;
      color: #b3e5fc;
    }

    /* âœ… NUEVO DISEÃ‘O EN 2 COLUMNAS */
    .paytable-grid {
      margin-top: 14px;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 14px;
    }

    .pay-block {
      background: rgba(255, 255, 255, 0.06);
      padding: 10px;
      border-radius: 10px;
      font-size: 0.78rem;
      line-height: 1.3;
      text-align: left;
    }

    .pay-block h4 {
      font-size: 0.85rem;
      color: #ffeb3b;
      margin-bottom: 6px;
      text-shadow: 0 0 8px rgba(255, 235, 59, 0.6);
    }

    .pay-note {
      margin-top: 10px;
      font-size: 0.75rem;
      color: #ffe082;
      text-align: center;
    }

    .nota {
      display: block;
      margin-top: 14px;
      font-size: 0.75rem;
      color: #b0bec5;
      line-height: 1.4;
    }

  </style>
</head>
<body>
  <div class="container">
    <h1>RED-B JACKPOT</h1>
    <p class="sub">
      TocÃ¡ el botÃ³n y <strong>probÃ¡ tu suerte</strong> ğŸ°
    </p>

    <div class="slot-wrapper" id="slotWrapper">
      <div class="slot-machine" id="slotMachine">
        <!-- 5 columnas Ã— 3 filas -->
        <div class="reel-column">
          <div class="cell" data-row="0" data-col="0">ğŸ’</div>
          <div class="cell" data-row="1" data-col="0">ğŸ‘‘</div>
          <div class="cell" data-row="2" data-col="0">ğŸ””</div>
        </div>
        <div class="reel-column">
          <div class="cell" data-row="0" data-col="1">ğŸ’ </div>
          <div class="cell" data-row="1" data-col="1">ğŸƒ</div>
          <div class="cell" data-row="2" data-col="1">â­</div>
        </div>
        <div class="reel-column">
          <div class="cell" data-row="0" data-col="2">ğŸ‘‘</div>
          <div class="cell" data-row="1" data-col="2">ğŸ’ </div>
          <div class="cell" data-row="2" data-col="2">ğŸ’</div>
        </div>
        <div class="reel-column">
          <div class="cell" data-row="0" data-col="3">ğŸ””</div>
          <div class="cell" data-row="1" data-col="3">â­</div>
          <div class="cell" data-row="2" data-col="3">ğŸƒ</div>
        </div>
        <div class="reel-column">
          <div class="cell" data-row="0" data-col="4">ğŸ’</div>
          <div class="cell" data-row="1" data-col="4">ğŸ‘‘</div>
          <div class="cell" data-row="2" data-col="4">ğŸ’ </div>
        </div>
      </div>
    </div>

    <button id="spinBtn">GIRAR RED-B JACKPOT</button>

    <p class="info-intentos" id="infoIntentos">Intentos restantes hoy: 3/3</p>

    <div id="mensaje"></div>

    <!-- âœ… NUEVA TABLA DE PREMIOS EN 2 COLUMNAS -->
    <div class="paytable-grid">

      <div class="pay-block">
        <h4>ğŸƒ JOKER JACKPOT</h4>
        <p>â€¢ 5 ğŸƒ â†’ <strong>50K fichas</strong></p>
        <p>â€¢ 4 ğŸƒ â†’ <strong>15K fichas</strong></p>
        <p>â€¢ 3 ğŸƒ â†’ <strong>10K fichas</strong></p>
      </div>

      <div class="pay-block">
        <h4>â­ ESTRELLAS</h4>
        <p>â€¢ 5 â­ â†’ <strong>2K fichas</strong></p>
        <p>â€¢ 4 â­ â†’ <strong>1K fichas</strong></p>
        <p>â€¢ 3 â­ â†’ <strong>500 fichas</strong></p>
      </div>

      <div class="pay-block">
        <h4>ğŸ’ DIAMANTES</h4>
        <p>â€¢ 5 ğŸ’ â†’ <strong>5K fichas</strong></p>
        <p>â€¢ 4 ğŸ’ â†’ <strong>2.5K fichas</strong></p>
        <p>â€¢ 3 ğŸ’ â†’ <strong>1K fichas</strong></p>
      </div>

      <div class="pay-block">
        <h4>ğŸ‘‘ CORONAS</h4>
        <p>â€¢ 5 ğŸ‘‘ â†’ <strong>500 fichas</strong></p>
        <p>â€¢ 4 ğŸ‘‘ â†’ <strong>300 fichas</strong></p>
        <p>â€¢ 3 ğŸ‘‘ â†’ <strong>100 fichas</strong></p>
      </div>

      <div class="pay-block">
        <h4>ğŸ”” CAMPANAS</h4>
        <p>â€¢ 5 ğŸ”” â†’ <strong>5K fichas</strong></p>
        <p>â€¢ 4 ğŸ”” â†’ <strong>3K fichas</strong></p>
        <p>â€¢ 3 ğŸ”” â†’ <strong>1K fichas</strong></p>
      </div>

      <div class="pay-block">
        <h4>ğŸ’  GEMAS</h4>
        <p>â€¢ 5 ğŸ’  â†’ <strong>6K fichas</strong></p>
        <p>â€¢ 4 ğŸ’  â†’ <strong>4K fichas</strong></p>
        <p>â€¢ 3 ğŸ’  â†’ <strong>2K fichas</strong></p>
      </div>

    </div>

    <p class="pay-note">
      Premios vÃ¡lidos solo si la combinaciÃ³n empieza en la 1Â° columna.
    </p>

    <small class="nota">
      Si tenÃ©s premio, sacÃ¡ captura y enviÃ¡la a la lÃ­nea RED-B.
    </small>
  </div>

  <script>
    const MAX_INTENTOS_DIA = 3;
    const STORAGE_KEY = "redb_jackpot_state_v8";

    const SYMBOLS = ["ğŸƒ", "â­", "ğŸ’", "ğŸ‘‘", "ğŸ””", "ğŸ’ "];

    const PRIZES = {
      "â­": { 3: 500, 4: 1000, 5: 2000 },
      "ğŸ’": { 3: 1000, 4: 2500, 5: 5000 },
      "ğŸ‘‘": { 3: 100, 4: 300, 5: 500 },
      "ğŸ””": { 3: 1000, 4: 3000, 5: 5000 },
      "ğŸ’ ": { 3: 2000, 4: 4000, 5: 6000 }
      // ğŸƒ nunca paga
    };

    const slotMachine = document.getElementById("slotMachine");
    const cells = Array.from(slotMachine.querySelectorAll(".cell"));
    const spinBtn = document.getElementById("spinBtn");
    const mensaje = document.getElementById("mensaje");
    const slotWrapper = document.getElementById("slotWrapper");
    const infoIntentos = document.getElementById("infoIntentos");

    function hoyString() {
      const h = new Date();
      return `${h.getFullYear()}-${String(h.getMonth()+1).padStart(2,"0")}-${String(h.getDate()).padStart(2,"0")}`;
    }

    function cargarEstado() {
      try {
        const data = JSON.parse(localStorage.getItem(STORAGE_KEY));
        const hoy = hoyString();
        if (!data || data.fecha !== hoy) {
          return {
            fecha: hoy,
            intentosUsados: 0
          };
        }
        return {
          fecha: data.fecha || hoy,
          intentosUsados: data.intentosUsados || 0
        };
      } catch {
        const hoy = hoyString();
        return {
          fecha: hoy,
          intentosUsados: 0
        };
      }
    }

    function guardarEstado(estado) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(estado));
    }

    function actualizarIntentosUI(estado) {
      const restantes = Math.max(0, MAX_INTENTOS_DIA - (estado.intentosUsados || 0));
      infoIntentos.textContent = `Intentos restantes hoy: ${restantes}/${MAX_INTENTOS_DIA}`;
    }

    function mensajeInfo(texto, tipo = null) {
      mensaje.innerHTML = texto;
      mensaje.classList.remove("ok", "error");
      if (tipo === "ok") mensaje.classList.add("ok");
      if (tipo === "error") mensaje.classList.add("error");
    }

    function simboloRandom() {
      return SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
    }

    function simboloRandomSinJoker() {
      const sinJoker = SYMBOLS.filter(s => s !== "ğŸƒ");
      return sinJoker[Math.floor(Math.random() * sinJoker.length)];
    }

    function simboloRandomDistinto(avoid, excludeJoker = false) {
      let pool = SYMBOLS.slice();
      if (excludeJoker) {
        pool = pool.filter(s => s !== "ğŸƒ");
      }
      pool = pool.filter(s => s !== avoid);
      if (pool.length === 0) pool = SYMBOLS.filter(s => s !== avoid);
      return pool[Math.floor(Math.random() * pool.length)];
    }

    function girarColumna(colIndex, duracion, callbackFin) {
      const colCells = cells.filter(c => parseInt(c.dataset.col, 10) === colIndex);
      const start = performance.now();

      function frame(now) {
        if (now - start < duracion) {
          colCells.forEach(cell => {
            cell.textContent = simboloRandom();
          });
          requestAnimationFrame(frame);
        } else {
          colCells.forEach(cell => {
            const row = parseInt(cell.dataset.row, 10);
            if (row === 1) {
              cell.textContent = simboloRandomSinJoker(); // fila central sin joker
            } else {
              cell.textContent = simboloRandom();
            }
          });
          callbackFin && callbackFin();
        }
      }

      requestAnimationFrame(frame);
    }

    function animarRodillosSecuencial(callbackFin) {
      const durBase = 550;
      let col = 0;

      function next() {
        if (col < 5) {
          girarColumna(col, durBase + col * 120, () => {
            col++;
            next();
          });
        } else {
          evitarCombinacionesProhibidas();
          callbackFin && callbackFin();
        }
      }

      next();
    }

    function evitarCombinacionesProhibidas() {
      // Evitar 5 iguales horizontales
      for (let row = 0; row < 3; row++) {
        const filaCells = [];
        for (let col = 0; col < 5; col++) {
          const cell = cells.find(
            c => parseInt(c.dataset.row, 10) === row && parseInt(c.dataset.col, 10) === col
          );
          filaCells.push(cell);
        }
        const symbol0 = filaCells[0].textContent;
        const todosIguales = filaCells.every(c => c.textContent === symbol0);
        if (todosIguales) {
          const middleCell = filaCells[2];
          const excludeJoker = (parseInt(middleCell.dataset.row, 10) === 1);
          middleCell.textContent = simboloRandomDistinto(symbol0, excludeJoker);
        }
      }

      // Evitar 3+ jokers horizontales
      for (let row = 0; row < 3; row++) {
        let runStart = -1;
        let runLength = 0;
        let current = null;

        for (let col = 0; col <= 5; col++) {
          let simbolo = null;
          if (col < 5) {
            const cell = cells.find(
              c => parseInt(c.dataset.row, 10) === row && parseInt(c.dataset.col, 10) === col
            );
            simbolo = cell ? cell.textContent : null;
          }

          if (simbolo === "ğŸƒ") {
            if (runLength === 0) runStart = col;
            runLength++;
            current = "ğŸƒ";
          } else {
            if (runLength >= 3 && current === "ğŸƒ") {
              const breakCol = runStart + 1;
              const breakCell = cells.find(
                c => parseInt(c.dataset.row, 10) === row && parseInt(c.dataset.col, 10) === breakCol
              );
              if (breakCell) {
                const excludeJoker = (parseInt(breakCell.dataset.row, 10) === 1);
                breakCell.textContent = simboloRandomDistinto("ğŸƒ", excludeJoker);
              }
            }
            runStart = -1;
            runLength = 0;
            current = null;
          }
        }
      }
    }

    function generarCodigo(simbolo, cantidad) {
      const ahora = new Date();
      const y = ahora.getFullYear();
      const m = String(ahora.getMonth()+1).padStart(2,"0");
      const d = String(ahora.getDate()).padStart(2,"0");
      const hh = String(ahora.getHours()).padStart(2,"0");
      const mm = String(ahora.getMinutes()).padStart(2,"0");
      const ss = String(ahora.getSeconds()).padStart(2,"0");

      const base = `${y}${m}${d}${hh}${mm}${ss}`;
      const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
      let rand = "";
      for (let i = 0; i < 4; i++) {
        rand += chars[Math.floor(Math.random() * chars.length)];
      }

      return `REDBJACK-${simbolo}${cantidad}-${base}-${rand}`;
    }

    function formatearFechaHora() {
      const ahora = new Date();
      const d = String(ahora.getDate()).padStart(2,"0");
      const m = String(ahora.getMonth()+1).padStart(2,"0");
      const y = ahora.getFullYear();
      const hh = String(ahora.getHours()).padStart(2,"0");
      const mm = String(ahora.getMinutes()).padStart(2,"0");
      const ss = String(ahora.getSeconds()).padStart(2,"0");
      return { fecha: `${d}/${m}/${y}`, hora: `${hh}:${mm}:${ss}` };
    }

    function obtenerGrid() {
      const grid = [];
      for (let row = 0; row < 3; row++) {
        const fila = [];
        for (let col = 0; col < 5; col++) {
          const cell = cells.find(
            c => parseInt(c.dataset.row, 10) === row && parseInt(c.dataset.col, 10) === col
          );
          fila.push({ simbolo: cell.textContent, cell });
        }
        grid.push(fila);
      }
      return grid;
    }

    // âœ… SOLO paga combinaciones que empiezan en la 1Â° columna (columna 0)
    function evaluarGanadores() {
      const grid = obtenerGrid();
      let mejorPremio = null;
      let mejoresCeldas = [];

      function evaluarLinea(positions) {
        if (positions.length === 0) return;
        const first = positions[0];
        const simbolo = grid[first.r][first.c].simbolo;
        const runCells = [grid[first.r][first.c].cell];
        let len = 1;

        for (let i = 1; i < positions.length; i++) {
          const { r, c } = positions[i];
          if (grid[r][c].simbolo === simbolo) {
            runCells.push(grid[r][c].cell);
            len++;
          } else {
            break;
          }
        }

        if (len >= 3 && PRIZES[simbolo] && PRIZES[simbolo][len]) {
          const fichas = PRIZES[simbolo][len];
          if (!mejorPremio || fichas > mejorPremio.fichas) {
            mejorPremio = { simbolo, cantidad: len, fichas };
            mejoresCeldas = runCells.slice();
          }
        }
      }

      const lineas = [
        [ { r:0,c:0 }, { r:0,c:1 }, { r:0,c:2 }, { r:0,c:3 }, { r:0,c:4 } ],
        [ { r:1,c:0 }, { r:1,c:1 }, { r:1,c:2 }, { r:1,c:3 }, { r:1,c:4 } ],
        [ { r:2,c:0 }, { r:2,c:1 }, { r:2,c:2 }, { r:2,c:3 }, { r:2,c:4 } ],
        [ { r:0,c:0 }, { r:1,c:1 }, { r:2,c:2 } ],
        [ { r:2,c:0 }, { r:1,c:1 }, { r:0,c:2 } ]
      ];

      lineas.forEach(evaluarLinea);

      if (mejorPremio) {
        return { premio: mejorPremio, celdas: mejoresCeldas };
      }
      return null;
    }

    function limpiarResaltados() {
      cells.forEach(cell => {
        cell.classList.remove("win-highlight");
      });
    }

    function mostrarPremio(premioInfo, celdas) {
      limpiarResaltados();
      celdas.forEach(cell => cell.classList.add("win-highlight"));

      slotWrapper.classList.add("shake");
      setTimeout(() => slotWrapper.classList.remove("shake"), 600);

      const { fecha, hora } = formatearFechaHora();
      const codigo = generarCodigo(premioInfo.simbolo, premioInfo.cantidad);

      mensajeInfo(`
        ğŸ‰ Â¡GANASTE <strong>${premioInfo.fichas} FICHAS</strong>! ğŸ‰<br>
        <small>
        Premio en fichas RED-B JACKPOT.<br>
        CombinaciÃ³n: ${premioInfo.cantidad} sÃ­mbolos ${premioInfo.simbolo} desde la 1Â° columna<br>
        Fecha: ${fecha} - ${hora}<br>
        CÃ³digo: ${codigo}<br><br>
        âœ… YA TE SALIÃ“ PREMIO<br>
        ğŸ“¸ SACÃ CAPTURA Y ENVIÃLA A LA LÃNEA
        </small>
      `, "ok");

      spinBtn.disabled = true;
    }

    function jugar() {
      let estado = cargarEstado();

      if (estado.intentosUsados >= MAX_INTENTOS_DIA) {
        mensajeInfo("Ya usaste tus 3 intentos de hoy. VolvÃ© maÃ±ana ğŸ”", "error");
        spinBtn.disabled = true;
        actualizarIntentosUI(estado);
        return;
      }

      estado.intentosUsados += 1;
      guardarEstado(estado);
      actualizarIntentosUI(estado);

      spinBtn.disabled = true;
      limpiarResaltados();
      mensajeInfo("Girando rodillos... ğŸ°", null);

      animarRodillosSecuencial(() => {
        const resultado = evaluarGanadores();

        if (resultado) {
          const { premio, celdas } = resultado;
          mostrarPremio(premio, celdas);
        } else {
          if (estado.intentosUsados >= MAX_INTENTOS_DIA) {
            mensajeInfo("Hoy no tocÃ³ premio ğŸ™ˆ Ya usaste tus 3 intentos. VolvÃ© maÃ±ana.", "error");
            spinBtn.disabled = true;
          } else {
            const restantes = MAX_INTENTOS_DIA - estado.intentosUsados;
            mensajeInfo(`Hoy no tocÃ³ premio ğŸ™ˆ Te quedan ${restantes} intento(s) hoy.`, "error");
            spinBtn.disabled = false;
          }
        }
      });
    }

    (function init() {
      const estado = cargarEstado();
      actualizarIntentosUI(estado);

      if (estado.intentosUsados >= MAX_INTENTOS_DIA) {
        spinBtn.disabled = true;
        mensajeInfo("Ya usaste tus 3 intentos de hoy. VolvÃ© maÃ±ana ğŸ”", "error");
      } else {
        spinBtn.disabled = false;
        mensajeInfo("TenÃ©s hasta 3 intentos hoy. Â¡Suerte! ğŸ€", "ok");
      }
    })();

    spinBtn.addEventListener("click", jugar);
  </script>
</body>
</html>
